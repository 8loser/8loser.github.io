<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="別在圍城時走散" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="別在圍城時走散" type="application/atom+xml"><link rel="alternate" type="application/json" title="別在圍城時走散" href="https://8loser.github.io/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/nyx-player-D6DYI4EP.js"></link><link rel="modulepreload" href="/js/copy-tex-IWCQTULD.js"></link><link rel="modulepreload" href="/js/post-ZPC2GCDH.js"></link><link rel="modulepreload" href="/js/chunk-XRFP4GIV.js"></link><link rel="modulepreload" href="/js/waline-LWZ2JMPT.js"></link><link rel="modulepreload" href="/js/comments-EPY2X7T3.js"></link><link rel="modulepreload" href="/js/chunk-3AROBAZR.js"></link><link rel="modulepreload" href="/js/search-SFLCHKOV.js"></link><link rel="modulepreload" href="/js/chunk-QKAVMTWO.js"></link><link rel="modulepreload" href="/js/chunk-QYZD64H2.js"></link><link rel="modulepreload" href="/js/index.esm-EGCUXW2O.js"></link><link rel="modulepreload" href="/js/chunk-XGRCSYS2.js"></link><link rel="modulepreload" href="/js/chunk-OVKFVIME.js"></link><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"></link><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/waline-IDNZKML2.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/comments-F4ZGS7LD.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="preload" href="https://picsum.photos/600/400?581808" as="image" fetchpriority="high"><link rel="preload" href="https://picsum.photos/600/400?285616" as="image" fetchpriority="high"><link rel="preload" href="https://picsum.photos/600/400?771957" as="image" fetchpriority="high"><link rel="preload" href="https://picsum.photos/600/400?691816" as="image" fetchpriority="high"><link rel="preload" href="https://picsum.photos/600/400?318606" as="image" fetchpriority="high"><link rel="preload" href="https://picsum.photos/600/400?758221" as="image" fetchpriority="high"><meta name="keywords" content="RAG,檢索增強生成"/><meta name="description" content="我在八樓閒晃"/><link rel="canonical" href="https://8loser.github.io/2026/02/07/rag-tutorial/"><link rel="stylesheet" href="/css/post.css?v=0.5.0"><link rel="stylesheet" href="/css/mermaid.css?v=0.5.0"><!-- 临时处理--><link rel="stylesheet" media="none" onload="this.media='all'" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css"><title>RAG 教學</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">RAG 教學</h1><div class="meta"><span class="item" title="創建時間：2026-02-07 10:00:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">發表於</span><time itemprop="dateCreated datePublished" datetime="2026-02-07T10:00:00+08:00">2026-02-07</time></span><span class="item" title="文章字數"><span class="icon"><i class="ic i-pen"></i></span><span class="text">文章字數</span><span>7.9k</span><span class="text">字</span></span><span class="item" title="所需閱讀時間"><span class="icon"><i class="ic i-clock"></i></span><span class="text">所需閱讀時間</span><span>7 分鐘</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切換導航欄"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">8 樓</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?581808&quot;);"></li><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?285616&quot;);"></li><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?771957&quot;);"></li><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?691816&quot;);"></li><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?318606&quot;);"></li><li class="item" style="background-image: url(&quot;https://picsum.photos/600/400?758221&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首頁</a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-TW"><link itemprop="mainEntityOfPage" href="https://8loser.github.io/2026/02/07/rag-tutorial/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="八樓的人"/><meta itemprop="description" content=", 我在八樓閒晃"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="別在圍城時走散"/></span><div class="body md" itemprop="articleBody"><h1 id="架構"><a class="anchor" href="#架構">#</a> 架構</h1>
<p>RAG（Retrieval-Augmented Generation; 檢索增強生成）</p>
<ul>
<li>
<p>R - Retrieval (檢索)<br />
 資料端： 原始文件經過 Embedding Model 轉為向量，存入 Vector DB。<br />
查詢端： 使用者問題同樣轉為向量，去資料庫進行相似度檢索（Similarity Search）。</p>
</li>
<li>
<p>A - Augmentation (增強)<br />
 組合： 將檢索出來的「外部知識（Context）」與「原始問題（Query）」放入一個 Prompt Template 中。<br />
任務： 這個動作是為了讓 LLM 擁有它原本訓練數據中沒有的特定資訊。</p>
</li>
<li>
<p>G - Generation (生成)<br />
 輸出： 將加強過的 Prompt 丟給 LLM。<br />
回覆： LLM 根據給定的參考資料產出精準的答案。</p>
</li>
</ul>
<p>我理解的架構圖<img loading="lazy" src="rag-diagram.png" alt="RAG diagram" /></p>
<details class="danger"><summary>Gemini 畫的啥玩意兒</summary><div>
<p><img loading="lazy" src="rag-diagram-gemini.png" alt="RAG diagram - Gemini" /></p>
</div></details>
<h1 id="需求"><a class="anchor" href="#需求">#</a> 需求</h1>
<ul>
<li>embed model：將聲音、圖片、影片、文字等轉成向量數值使用</li>
<li>vector db：儲存向量數據及對應內容</li>
<li>LLM：生成式 AI</li>
</ul>
<h1 id="embedding"><a class="anchor" href="#embedding">#</a> Embedding</h1>
<p>使用 Sentence-Transformers 載入 embed model，將文字轉成高維度向量特徵。</p>
<details class="info"><summary>安裝依賴套件</summary><div>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> sentence-transformers</pre></td></tr></table></figure></div></details>
<figure class="highlight python"><figcaption data-lang="python"><span>Embedding</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 加上 huggingface 的鏡像站點環境變數，避免下載模型太慢</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="3"></td><td><pre>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"HF_ENDPOINT"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"https://hf-mirror.com"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 載入模型</span></pre></td></tr><tr><td data-num="7"></td><td><pre>model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 準備文字</span></pre></td></tr><tr><td data-num="10"></td><td><pre>sentences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"這是一段測試文字"</span><span class="token punctuation">,</span> <span class="token string">"EndeavourOS 開發環境"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 取得 Feature Vector</span></pre></td></tr><tr><td data-num="13"></td><td><pre>embeddings <span class="token operator">=</span> model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 查看 Shape [句子數量，每個句子的維度]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 輸出會是 (2, 384)，代表 2 個句子，每個句子 384 維，是 all-MiniLM-L6-v2 模型的特徵維度。</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"向量形狀 (embeddings.shape): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 查看具體數值 (只印出第一句的前 5 個特徵值作為範例)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"第一句的前 5 個特徵值: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>embeddings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">5]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 執行結果</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 向量形狀 (embeddings.shape): (2, 384)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 第一句的前 5 個特徵值: [0.03097137 0.09432378 0.04806018 0.02745436 0.02937624]</span></pre></td></tr></table></figure><div class="note info">
<ul>
<li>除了 Sentence-Transformers 也可以用 Ollama 載入 embed model，呼叫 Ollama API 取得向量值</li>
<li>選對模型很重要，改成  <code>paraphrase-multilingual-MiniLM-L12-v2</code>  模型，對中文理解程度比較高</li>
<li>聲音、圖片、影片、文字轉為高維度向量特徵，這個過程叫  <code>embedding</code></li>
</ul>
</div>
<h1 id="vector-db"><a class="anchor" href="#vector-db">#</a> Vector DB</h1>
<p>將向量與內容存入 vector db，後續可以搜尋跟問題相似度高的內容，這裡選用 Qdrant</p>
<details class="info"><summary>安裝依賴套件</summary><div>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> sentence-transformers qdrant-client</pre></td></tr></table></figure></div></details>
<details class="info"><summary>可以用 docker 或 podman 啟動 Qdrant</summary><div>
<figure class="highlight bash"><figcaption data-lang="bash"><span>啟動 Qdrant container</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">podman</span> run <span class="token parameter variable">-p</span> <span class="token number">6333</span>:6333 <span class="token parameter variable">-p</span> <span class="token number">6334</span>:6334 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token parameter variable">-v</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/qdrant_storage:/qdrant/storage:z <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    docker.io/qdrant/qdrant</pre></td></tr></table></figure></div></details>
<figure class="highlight python"><figcaption data-lang="python"><span>Vector DB</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"HF_ENDPOINT"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"https://hf-mirror.com"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> qdrant_client <span class="token keyword">import</span> QdrantClient</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> qdrant_client<span class="token punctuation">.</span>models <span class="token keyword">import</span> Distance<span class="token punctuation">,</span> VectorParams<span class="token punctuation">,</span> PointStruct</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 載入 Embed Model, 改用 paraphrase-multilingual-MiniLM-L12-v2 對中文理解程度比較好</span></pre></td></tr><tr><td data-num="8"></td><td><pre>model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'paraphrase-multilingual-MiniLM-L12-v2'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 建立 Qdrant 客戶端</span></pre></td></tr><tr><td data-num="11"></td><td><pre>client <span class="token operator">=</span> QdrantClient<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6333</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># collection 不存在則建立</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># size 為 384, 必須跟 embed model 維度搭配</span></pre></td></tr><tr><td data-num="15"></td><td><pre>collection_name <span class="token operator">=</span> <span class="token string">"multilingual_notes"</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> client<span class="token punctuation">.</span>collection_exists<span class="token punctuation">(</span>collection_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    client<span class="token punctuation">.</span>create_collection<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        collection_name<span class="token operator">=</span>collection_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        vectors_config<span class="token operator">=</span>VectorParams<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">384</span><span class="token punctuation">,</span> distance<span class="token operator">=</span>Distance<span class="token punctuation">.</span>COSINE<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 準備寫入的資料</span></pre></td></tr><tr><td data-num="23"></td><td><pre>documents <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"EndeavourOS 使用 pacman 作為套件管理器。"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"Python 的虛擬環境可以透過 venv 模組建立。"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"Vector Database 負責儲存高維度的向量數據。"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"等春節特賣叫隔壁王叔叔買給你"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"牛仔褲特賣會在下週末舉行，別忘了去看看！"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment"># 批次產生每個內容的向量，利用 GPU 加速批次處理省效能</span></pre></td></tr><tr><td data-num="32"></td><td><pre>texts <span class="token operator">=</span> <span class="token punctuation">[</span>doc<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> doc <span class="token keyword">in</span> documents<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre>vectors <span class="token operator">=</span> model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment"># 建立向量與內容資料點</span></pre></td></tr><tr><td data-num="36"></td><td><pre>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span> doc <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>documents<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    points<span class="token punctuation">.</span>append<span class="token punctuation">(</span>PointStruct<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token builtin">id</span><span class="token operator">=</span>doc<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        vector<span class="token operator">=</span>vectors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        payload<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"page_content"</span><span class="token punctuation">:</span> doc<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment"># 新增資料點到 Qdrant</span></pre></td></tr><tr><td data-num="45"></td><td><pre>client<span class="token punctuation">.</span>upsert<span class="token punctuation">(</span>collection_name<span class="token operator">=</span>collection_name<span class="token punctuation">,</span> points<span class="token operator">=</span>points<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment"># 語義搜尋測試</span></pre></td></tr><tr><td data-num="48"></td><td><pre>query_text <span class="token operator">=</span> <span class="token string">"媽媽我好想要一台 Steam Deck"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>query_vector <span class="token operator">=</span> model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>query_text<span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>search_result <span class="token operator">=</span> client<span class="token punctuation">.</span>query_points<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    collection_name<span class="token operator">=</span>collection_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    query<span class="token operator">=</span>query_vector<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token comment"># 搜尋相似度最高的 5 筆</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    limit<span class="token operator">=</span><span class="token number">5</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">.</span>points</pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment"># 顯示搜尋結果</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"--- 針對「</span><span class="token interpolation"><span class="token punctuation">&#123;</span>query_text<span class="token punctuation">&#125;</span></span><span class="token string">」搜尋到前 </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>search_result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> 筆相關資料 ---"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span> res <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>search_result<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    content <span class="token operator">=</span> res<span class="token punctuation">.</span>payload<span class="token punctuation">[</span><span class="token string">'page_content'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    score <span class="token operator">=</span> res<span class="token punctuation">.</span>score</pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">. [分數: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>score<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment"># 執行結果</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment"># --- 針對「媽媽我好想要一台 Steam Deck」搜尋到前 5 筆相關資料 ---</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment"># 1. [分數: 0.2213] 等春節特賣叫隔壁王叔叔買給你</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment"># 2. [分數: 0.1929] 牛仔褲特賣會在下週末舉行，別忘了去看看！</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment"># 3. [分數: -0.0284] Python 的虛擬環境可以透過 venv 模組建立。</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment"># 4. [分數: -0.0446] Vector Database 負責儲存高維度的向量數據。</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment"># 5. [分數: -0.0561] EndeavourOS 使用 pacman 作為套件管理器。</span></pre></td></tr></table></figure><div class="note info">
<ul>
<li>餘弦相似度：數值在 <em><strong>-1 ~ 1</strong></em> 之間 分數越高越好，代表語義越接近。可以調整 distance=Distance.COSINE 修改成其他演算法。</li>
<li>Vector db 選型須根據使用的 embed model，需要可以儲存該 model 使用的維度</li>
<li>可以建立不同維度的 collection</li>
</ul>
</div>
<p>Qdrant 有 web 界面 <img loading="lazy" src="qdrant.png" alt="Qdrant" /></p>
<h1 id="rag"><a class="anchor" href="#rag">#</a> RAG</h1>
<p>要進行 RAG 還差 LLM (Large Language Model), LLM 屬於 RAG 的 G (Generate), 這邊使用 Ollama 載入 llama3</p>
<details class="info"><summary>安裝依賴套件</summary><div>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> langchain-huggingface langchain-qdrant langchain-ollama langchain-core</pre></td></tr></table></figure></div></details>
<details class="info"><summary>在 Arch Linux 安裝 Ollama</summary><div>
<figure class="highlight bash"><figcaption data-lang="bash"><span>安裝 Ollama</span></figcaption><table><tr><td data-num="1"></td><td><pre>yay <span class="token parameter variable">-S</span> ollama-cuda</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> systemctl start ollama</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 檢查是否啟用成功</span></pre></td></tr><tr><td data-num="4"></td><td><pre>systemctl is-active ollama</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 載入 llama3 模型</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ollama run llama3</pre></td></tr></table></figure></div></details>
<figure class="highlight python"><figcaption data-lang="python"><span>RAG demo</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 鏡像加速（如果模型已下載則會自動跳過）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"HF_ENDPOINT"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"https://hf-mirror.com"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> langchain_huggingface <span class="token keyword">import</span> HuggingFaceEmbeddings</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> langchain_qdrant <span class="token keyword">import</span> QdrantVectorStore</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">from</span> langchain_ollama <span class="token keyword">import</span> ChatOllama</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> ChatPromptTemplate</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>runnables <span class="token keyword">import</span> RunnablePassthrough</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> StrOutputParser</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 統一模型名稱，要跟寫入 vector db 時使用的模型一致</span></pre></td></tr><tr><td data-num="13"></td><td><pre>EMBEDDING_MODEL_NAME <span class="token operator">=</span> <span class="token string">"paraphrase-multilingual-MiniLM-L12-v2"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>embeddings <span class="token operator">=</span> HuggingFaceEmbeddings<span class="token punctuation">(</span>model_name<span class="token operator">=</span>EMBEDDING_MODEL_NAME<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># Retrieval - 用於檢索的向量資料庫</span></pre></td></tr><tr><td data-num="17"></td><td><pre>vector_store <span class="token operator">=</span> QdrantVectorStore<span class="token punctuation">.</span>from_existing_collection<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    embedding<span class="token operator">=</span>embeddings<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    collection_name<span class="token operator">=</span><span class="token string">"multilingual_notes"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    url<span class="token operator">=</span><span class="token string">"http://127.0.0.1:6333"</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># Augmentation - 定義詢問 LLM 的 prompt 模板</span></pre></td></tr><tr><td data-num="25"></td><td><pre>template <span class="token operator">=</span> <span class="token triple-quoted-string string">"""你是一個基於本地知識庫的 AI 助手。</pre></td></tr><tr><td data-num="26"></td><td><pre>請根據以下提供的「參考資料」回答「問題」。</pre></td></tr><tr><td data-num="27"></td><td><pre>如果參考資料中沒有相關答案，請誠實告知你不知道。</pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>[參考資料]:</pre></td></tr><tr><td data-num="30"></td><td><pre>&#123;context&#125;</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>[問題]:</pre></td></tr><tr><td data-num="33"></td><td><pre>用中文回答 `&#123;question&#125;`</pre></td></tr><tr><td data-num="34"></td><td><pre>"""</span></pre></td></tr><tr><td data-num="35"></td><td><pre>prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>template<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># 檢索設定，檢索相似度最高的 2 筆資料</span></pre></td></tr><tr><td data-num="38"></td><td><pre>retriever <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>as_retriever<span class="token punctuation">(</span>search_kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"k"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># 文檔格式化函數</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">def</span> <span class="token function">format_docs</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>page_content <span class="token keyword">for</span> doc <span class="token keyword">in</span> docs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment"># Generation - 使用的生成模型</span></pre></td></tr><tr><td data-num="45"></td><td><pre>llm <span class="token operator">=</span> ChatOllama<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">"llama3"</span><span class="token punctuation">,</span> base_url<span class="token operator">=</span><span class="token string">"http://localhost:11434"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment"># 構建 RAG 鏈，執行：搜尋 Qdrant -> 填入模板 -> 丟給 Llama3 -> 輸出文字</span></pre></td></tr><tr><td data-num="48"></td><td><pre>rag_chain <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token string">"context"</span><span class="token punctuation">:</span> retriever <span class="token operator">|</span> format_docs<span class="token punctuation">,</span>      <span class="token comment"># 從向量庫檢索並格式化文檔</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token string">"question"</span><span class="token punctuation">:</span> RunnablePassthrough<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 原樣傳遞用戶問題</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token operator">|</span> RunnablePassthrough<span class="token punctuation">.</span>assign<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token comment"># prompt - 接收 &#123;context, question&#125;，生成格式化的提示詞</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token comment"># llm - 將提示詞發送給 Llama3 模型，得到 AI 回答</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token comment"># StrOutputParser () - 將 LLM 的輸出（通常是個 AIMessage 對象）轉換成純文字字符串</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token comment"># | 是 LangChain 的 LCEL 語法</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        answer<span class="token operator">=</span>prompt <span class="token operator">|</span> llm <span class="token operator">|</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment"># 執行對話測試</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    query <span class="token operator">=</span> <span class="token string">"EndeavourOS 適合什麼樣的開發者？"</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n提問：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    </pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token comment"># R - Retrieval：從向量庫檢索相關文檔</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n----------R Retrieval 檢索階段----------"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    docs <span class="token operator">=</span> retriever<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>query<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    formatted_context <span class="token operator">=</span> format_docs<span class="token punctuation">(</span>docs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"檢索到的參考資料（</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> 筆）：\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>formatted_context<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    </pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token comment"># A - Augmentation：將檢索結果填入提示詞</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n----------A Augmentation 增強階段----------"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    augmented_prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"context"</span><span class="token punctuation">:</span> formatted_context<span class="token punctuation">,</span> <span class="token string">"question"</span><span class="token punctuation">:</span> query<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"生成的提示詞：\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>augmented_prompt<span class="token punctuation">.</span>to_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    </pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token comment"># G - Generation：LLM 生成回答</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n----------G Generation 生成階段----------"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    result <span class="token operator">=</span> rag_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>query<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"AI 回答：\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token comment"># 執行結果</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token comment"># 提問：EndeavourOS 適合什麼樣的開發者？</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token comment"># ----------R Retrieval 檢索階段 ----------</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token comment"># 檢索到的參考資料（2 筆）：</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment"># EndeavourOS 使用 pacman 作為套件管理器。</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment"># Python 的虛擬環境可以透過 venv 模組建立。</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment"># ----------A Augmentation 增強階段 ----------</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token comment"># 生成的提示詞：</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token comment"># Human: 你是一個基於本地知識庫的 AI 助手。</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token comment"># 請根據以下提供的「參考資料」回答「問題」。</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token comment"># 如果參考資料中沒有相關答案，請誠實告知你不知道。</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token comment"># [參考資料]:</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token comment"># EndeavourOS 使用 pacman 作為套件管理器。</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token comment"># Python 的虛擬環境可以透過 venv 模組建立。</span></pre></td></tr><tr><td data-num="101"></td><td><pre></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token comment"># [問題]:</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token comment"># 用中文回答 `EndeavourOS 適合什麼樣的開發者？`</span></pre></td></tr><tr><td data-num="104"></td><td><pre></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token comment"># ----------G Generation 生成階段 ----------</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment"># AI 回答：</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token comment"># 根據提供的參考資料，EndeavourOS 使用 pacman 作為套件管理器。因此，我們可以知道 EndeavourOS 是一種 Linux 發行版。</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token comment"># 結論：EndeavourOS 适合 Linux 開發者的需求。</span></pre></td></tr></table></figure><div class="note info">
<ul>
<li>如果原本用 A 模型建立的 db 後來想改 B 模型怎麼辦？要進行 Re-indexing</li>
<li>後續可以增加避免幻覺機制，相似度閥值判定，參考資料不足處理機制等等...</li>
</ul>
</div>
<div class="tags"><a href="/tags/RAG/" rel="tag"><i class="ic i-tag"></i>RAG</a><a href="/tags/AI/" rel="tag"><i class="ic i-tag"></i>AI</a><a href="/tags/%E6%AA%A2%E7%B4%A2%E5%A2%9E%E5%BC%B7%E7%94%9F%E6%88%90/" rel="tag"><i class="ic i-tag"></i>檢索增強生成</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-eye"></i></span><span class="text">總瀏覽次數：</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2026/02/07/rag-tutorial/">載入中...</span></span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新於 </span><time title="修改時間：2026-02-07 23:00:02" itemprop="dateModified" datetime="2026-02-07T23:00:02+08:00">2026-02-07</time></span></div><div id="copyright"><ul><li class="author"><strong>作者：</strong>八樓的人<i class="ic i-at"><em>@</em></i>別在圍城時走散</li><li class="link"><strong>文章連結：</strong><a href="https://8loser.github.io/2026/02/07/rag-tutorial/" title="RAG 教學">https://8loser.github.io/2026/02/07/rag-tutorial/</a></li><li class="license"><strong>版權聲明：</strong>本網誌所有文章除特別聲明外，均採用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 許可協議。轉載請註明出處！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2025/12/21/deploy-docker-nginx/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;picsum.photos&#x2F;600&#x2F;400?328431" title="多服務 Docker 部署與 Nginx 設定筆記"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>Deploy</span><h3>多服務 Docker 部署與 Nginx 設定筆記</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目錄"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%A7%8B"><span class="toc-number">1.</span> <span class="toc-text"> 架構</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text"> 需求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#embedding"><span class="toc-number">3.</span> <span class="toc-text"> Embedding</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vector-db"><span class="toc-number">4.</span> <span class="toc-text"> Vector DB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rag"><span class="toc-number">5.</span> <span class="toc-text"> RAG</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="本站概要"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="八樓的人" src="/assets/avatar.jpg"/><p class="name" itemprop="name">八樓的人</p><div class="description" itemprop="description">我在八樓閒晃</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">27</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span><span class="name">分類</span></a></div><div class="item tags"><a href="/tags/"><span class="count">39</span><span class="name">標籤</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/8loser" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;8loser"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首頁</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>關於</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>歸檔</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分類</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>標籤</a></li></ul></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/12/21/deploy-docker-nginx/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div><div id="player"></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>隨機文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Trouble/" title="分類於Trouble">Trouble</a></div><span><a href="/2022/10/21/nginx-websocket/">Nginx websocket 無法連接</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/01/04/gcp-init/">GCP VM 初始化</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/06/26/git_of_devcontainer/">VSCode devcontainer 使用 git</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Trouble/" title="分類於Trouble">Trouble</a></div><span><a href="/2024/06/17/dev-container-bind-source-error/">bind source path does not exist</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Trouble/" title="分類於Trouble">Trouble</a></div><span><a href="/2023/07/14/fixing-mixed-content/">瀏覽器出現 Mixed Content 訊息</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Need-to-Know/" title="分類於Need to Know">Need to Know</a></div><span><a href="/2022/05/14/init/">init</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Step-By-Step/" title="分類於Step By Step">Step By Step</a></div><span><a href="/2024/06/16/shokaX-waline-comment/">Hexo ShokaX 主題使用 Waline 留言版</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Trouble/" title="分類於Trouble">Trouble</a><i class="ic i-angle-right"></i><a href="/categories/Trouble/Deploy/" title="分類於Deploy">Deploy</a></div><span><a href="/2023/08/27/static-web-page-refresh-404/">靜態網頁 refresh 出現 404</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/03/12/reduce-frontend-docker-image/">縮減靜態網頁 Docker image 大小</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Need-to-Know/" title="分類於Need to Know">Need to Know</a></div><span><a href="/2022/07/23/docker-access-host/">Docker Container 存取 host 服務</a></span></li></ul></div><div class="rpost pjax"><h2>最新評論</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2026</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">八樓的人 @ 8 樓</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="總字數">71k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="所需總閱讀時間">1:04</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
    path: `2026/02/07/rag-tutorial/`,
    favicon: {
        show: `（●´3｀●）復活成功`,
        hide: `(´Д｀)瀏覽器崩潰啦`
    },
    search: {
        placeholder: "文章搜尋",
        empty: "關於 「 ${query} 」 ，什麼也沒搜到",
        stats: "${time} ms 內找到 ${hits} 條結果"
    },
    nocopy: "false",
    copyright: `複製成功，轉載請遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 協議。`,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章時效性提示</span><br>這是一篇發佈於 {{publish}} 天前，最後一次更新在 {{updated}} 天前的文章，部分信息可能已經發生改變，請注意甄別。</p></div>`,
    quiz: {
        choice: `單選題`,
        multiple: `多選題`,
        true_false: `判斷題`,
        essay: `問答題`,
        gap_fill: `填空題`,
        mistake: `錯題備註`
    }
};
</script><script src="/js/siteInit.js?v=0.5.0" type="module" fetchpriority="high" defer></script></body></html>